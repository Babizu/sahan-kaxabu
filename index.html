<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å™¶å“ˆå·«åƒè©è¨˜æ†¶å¡</title>
    
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=LXGW+WenKai+TC&family=Noto+Serif+TC:wght@600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'LXGW WenKai TC', sans-serif;
            background-color: #fdfbf7;
            color: #3d3d3d;
        }
        
        .font-serif-tc {
            font-family: 'Noto Serif TC', serif;
        }

        .perspective-1000 {
            perspective: 1000px;
        }
        
        .transform-style-3d {
            transform-style: preserve-3d;
        }
        
        .backface-hidden {
            backface-visibility: hidden;
        }
        
        .rotate-y-180 {
            transform: rotateY(180deg);
        }

        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #d4c5b0; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #c4b5a0; 
        }

        @keyframes pulse-earth {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }

        .animate-pulse-earth {
            animation: pulse-earth 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ramie: {
                            50: '#fbf5f4',
                            100: '#f6e8e7',
                            200: '#edd4d2',
                            300: '#dfb4b1',
                            400: '#c88682',
                            500: '#af605b',
                            600: '#984843',
                            700: '#78141e',
                            800: '#69322c',
                            900: '#582d29',
                        },
                        earth: {
                            100: '#f5f2ea',
                            200: '#e6e2d6',
                            800: '#4a4843',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <div id="app" class="flex flex-col h-full">

        <!-- é é¦– -->
        <header class="bg-white border-b border-earth-200 px-4 py-3 flex items-center justify-between shadow-sm z-10">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-ramie-700 rounded-lg flex items-center justify-center text-white shadow-md">
                    <span class="font-serif-tc font-bold text-xl">ğ•‚</span>
                </div>
                <div>
                    <h1 class="font-serif-tc text-xl font-bold text-ramie-900 leading-tight">å™¶å“ˆå·«åƒè©è¨˜æ†¶å¡</h1>
                    <p class="text-xs text-gray-500">saanu pitelet Kaxabu a ahan</p>
                </div>
            </div>
            
            <div class="hidden md:flex gap-1 bg-earth-100 p-1 rounded-lg">
                <button @click="currentView = 'study'" :class="navClass('study')" class="px-4 py-1.5 rounded-md text-sm font-medium transition-all duration-200 flex items-center gap-2">
                    <i class="ph ph-cards text-lg"></i> èƒŒèª¦
                </button>
                <button @click="currentView = 'search'" :class="navClass('search')" class="px-4 py-1.5 rounded-md text-sm font-medium transition-all duration-200 flex items-center gap-2">
                    <i class="ph ph-magnifying-glass text-lg"></i> è©å½™è¡¨
                </button>
                <button @click="currentView = 'stats'" :class="navClass('stats')" class="px-4 py-1.5 rounded-md text-sm font-medium transition-all duration-200 flex items-center gap-2">
                    <i class="ph ph-chart-bar text-lg"></i> ç‹€æ…‹
                </button>
                <button @click="currentView = 'settings'" :class="navClass('settings')" class="px-4 py-1.5 rounded-md text-sm font-medium transition-all duration-200 flex items-center gap-2">
                    <i class="ph ph-gear text-lg"></i> è¨­å®š
                </button>
                <button @click="currentView = 'about'" :class="navClass('about')" class="px-4 py-1.5 rounded-md text-sm font-medium transition-all duration-200 flex items-center gap-2">
                    <i class="ph ph-info text-lg"></i> é—œæ–¼
                </button>
            </div>
            <!-- æ‰‹æ©Ÿç‰ˆé¸å–®åˆ‡æ›æŒ‰éˆ• -->
            <button @click="mobileMenuOpen = !mobileMenuOpen" class="md:hidden text-gray-600">
                <i class="ph ph-list text-2xl"></i>
            </button>
        </header>

        <!-- æ‰‹æ©Ÿç‰ˆé¸å–® -->
        <div v-if="mobileMenuOpen" class="md:hidden bg-white border-b border-earth-200 p-4 absolute top-16 left-0 right-0 z-50 shadow-lg flex flex-col gap-2">
            <button @click="navigate('study')" class="p-3 text-left rounded-lg hover:bg-earth-100 flex items-center gap-3">
                <i class="ph ph-cards text-xl text-ramie-700"></i> èƒŒèª¦å–®å­—
            </button>
            <button @click="navigate('search')" class="p-3 text-left rounded-lg hover:bg-earth-100 flex items-center gap-3">
                <i class="ph ph-magnifying-glass text-xl text-ramie-700"></i> è©å½™è¡¨æŸ¥è©¢
            </button>
            <button @click="navigate('stats')" class="p-3 text-left rounded-lg hover:bg-earth-100 flex items-center gap-3">
                <i class="ph ph-chart-bar text-xl text-ramie-700"></i> å­¸ç¿’ç‹€æ…‹
            </button>
            <button @click="navigate('settings')" class="p-3 text-left rounded-lg hover:bg-earth-100 flex items-center gap-3">
                <i class="ph ph-gear text-xl text-ramie-700"></i> ç³»çµ±è¨­å®š
            </button>
            <button @click="navigate('about')" class="p-3 text-left rounded-lg hover:bg-earth-100 flex items-center gap-3">
                <i class="ph ph-info text-xl text-ramie-700"></i> é—œæ–¼
            </button>
        </div>

        <!-- ä¸»è¦å…§å®¹ -->
        <main class="flex-1 overflow-y-auto bg-earth-100/50 relative">

            <!-- å¼•å°å½ˆçª— -->
            <div v-if="showOnboarding" class="absolute inset-0 flex items-center justify-center bg-black/50 z-50 p-4">
                <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-ramie-700 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="font-serif-tc font-bold text-3xl text-white">ğ•‚</span>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">æ­¡è¿å­¸ç¿’å™¶å“ˆå·«èªï¼</h2>
                        <p class="text-gray-600 text-sm">è«‹é¸æ“‡ä½ æƒ³è¦å­¸ç¿’çš„é›£åº¦ç­‰ç´š</p>
                    </div>

                    <div class="space-y-3 mb-6">
                        <label class="flex items-center gap-3 p-3 rounded-lg border-2 transition-all cursor-pointer"
                               :class="tempSelectedLevels.includes('åˆç´š') ? 'border-green-500 bg-green-50' : 'border-gray-200 hover:border-gray-300'">
                            <input type="checkbox" v-model="tempSelectedLevels" value="åˆç´š" class="w-5 h-5 text-green-600 focus:ring-green-500 rounded">
                            <div class="flex-1">
                                <span class="font-medium text-gray-800">åˆç´š</span>
                                <span class="ml-2 text-xs px-2 py-0.5 rounded-full bg-green-100 text-green-700">é©åˆåˆå­¸è€…</span>
                            </div>
                        </label>

                        <label class="flex items-center gap-3 p-3 rounded-lg border-2 transition-all cursor-pointer"
                               :class="tempSelectedLevels.includes('ä¸­ç´š') ? 'border-yellow-500 bg-yellow-50' : 'border-gray-200 hover:border-gray-300'">
                            <input type="checkbox" v-model="tempSelectedLevels" value="ä¸­ç´š" class="w-5 h-5 text-yellow-600 focus:ring-yellow-500 rounded">
                            <div class="flex-1">
                                <span class="font-medium text-gray-800">ä¸­ç´š</span>
                                <span class="ml-2 text-xs px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-700">æœ‰åŸºç¤è€…</span>
                            </div>
                        </label>

                        <label class="flex items-center gap-3 p-3 rounded-lg border-2 transition-all cursor-pointer"
                               :class="tempSelectedLevels.includes('ä¸­é«˜ç´š') ? 'border-orange-500 bg-orange-50' : 'border-gray-200 hover:border-gray-300'">
                            <input type="checkbox" v-model="tempSelectedLevels" value="ä¸­é«˜ç´š" class="w-5 h-5 text-orange-600 focus:ring-orange-500 rounded">
                            <div class="flex-1">
                                <span class="font-medium text-gray-800">ä¸­é«˜ç´š</span>
                                <span class="ml-2 text-xs px-2 py-0.5 rounded-full bg-orange-100 text-orange-700">é€²ä¸€æ­¥å­¸ç¿’</span>
                            </div>
                        </label>

                        <label class="flex items-center gap-3 p-3 rounded-lg border-2 transition-all cursor-pointer"
                               :class="tempSelectedLevels.includes('é«˜ç´š') ? 'border-red-500 bg-red-50' : 'border-gray-200 hover:border-gray-300'">
                            <input type="checkbox" v-model="tempSelectedLevels" value="é«˜ç´š" class="w-5 h-5 text-red-600 focus:ring-red-500 rounded">
                            <div class="flex-1">
                                <span class="font-medium text-gray-800">é«˜ç´š</span>
                                <span class="ml-2 text-xs px-2 py-0.5 rounded-full bg-red-100 text-red-700">isiw ka mabaza dahu lia</span>
                            </div>
                        </label>
                    </div>

                    <div class="text-xs text-gray-500 mb-4 text-center">
                        <i class="ph ph-info"></i> ä½ å¯ä»¥éš¨æ™‚åœ¨ã€Œç³»çµ±è¨­å®šã€ä¸­ä¿®æ”¹é€™äº›é¸é …ã€‚æ­¤ç¶²é å­¸ç¿’é€²åº¦æ˜¯è¨˜éŒ„åœ¨ç€è¦½å™¨ä¸­ï¼Œç„¡é›²ç«¯é€²åº¦ç³»çµ±ã€‚æ•…å»ºè­°ä»¥å¸¸ç”¨ç€è¦½å™¨é–‹å•Ÿï¼Œä¸¦å¶çˆ¾å‚™ä»½ã€‚
                    </div>

                    <button @click="completeOnboarding"
                            :disabled="tempSelectedLevels.length === 0"
                            class="w-full py-3 rounded-xl font-bold text-white transition-all"
                            :class="tempSelectedLevels.length > 0 ? 'bg-ramie-700 hover:bg-ramie-800 shadow-lg' : 'bg-gray-300 cursor-not-allowed'">
                        é–‹å§‹å­¸ç¿’ {{ tempSelectedLevels.length > 0 ? `(å·²é¸ ${tempSelectedLevels.length} å€‹é›£åº¦)` : '(è«‹è‡³å°‘é¸æ“‡ä¸€å€‹é›£åº¦)' }}
                    </button>
                </div>
            </div>

            <!-- è¼‰å…¥ç‹€æ…‹ -->
            <div v-if="loading" class="absolute inset-0 flex flex-col items-center justify-center bg-white z-40">
                <div class="w-12 h-12 border-4 border-ramie-200 border-t-ramie-700 rounded-full animate-spin mb-4"></div>
                <p class="text-ramie-800 font-medium">æ­£åœ¨è¼‰å…¥è©å½™åº«...</p>
                <p class="text-xs text-gray-500 mt-2">è«‹ç¢ºä¿ kaxabu_words.json ä½æ–¼åŒä¸€ç›®éŒ„</p>
            </div>

            <!-- éŒ¯èª¤ç‹€æ…‹ -->
            <div v-if="error" class="absolute inset-0 flex flex-col items-center justify-center bg-white z-40 p-6 text-center">
                <i class="ph ph-warning-circle text-4xl text-red-500 mb-4"></i>
                <h3 class="text-xl font-bold text-gray-800 mb-2">è¼‰å…¥å¤±æ•—</h3>
                <p class="text-gray-600 mb-4">{{ error }}</p>
                <button @click="loadData" class="px-4 py-2 bg-ramie-700 text-white rounded-lg hover:bg-ramie-800">é‡è©¦</button>
            </div>

            <!-- VIEWï¼šå­¸ç¿’ï¼ˆè¨˜æ†¶å¡ï¼‰ -->
            <div v-if="currentView === 'study' && !loading" class="h-full flex flex-col items-center justify-center p-4 max-w-2xl mx-auto">

                <div v-if="sessionQueue.length > 0 && currentCard" class="w-full h-full flex flex-col">
                    <!-- é€²åº¦æ¢ -->
                    <div class="w-full flex justify-between text-sm text-gray-500 mb-2 px-1">
                        <span>ä»Šæ—¥é€²åº¦</span>
                        <span>{{ sessionCompleted }} / {{ sessionTotal }}</span>
                    </div>
                    <div class="w-full h-2 bg-gray-200 rounded-full mb-6 overflow-hidden">
                        <div class="h-full bg-ramie-600 transition-all duration-300" :style="{ width: (sessionCompleted / sessionTotal * 100) + '%' }"></div>
                    </div>

                    <!-- è¨˜æ†¶å¡èˆ‡æŒ‰éˆ•å®¹å™¨ -->
                    <div class="flex-1 flex flex-col items-center justify-center w-full">
                        <!-- è¨˜æ†¶å¡å€åŸŸ -->
                        <div class="perspective-1000 w-full relative group" @click="flipCard">
                            <!-- ç¿»å¡å‹•ç•«æ™‚é•·ï¼šduration-300 = 300ms -->
                            <div :class="['relative w-full aspect-[4/3] md:aspect-[3/2] transition-transform duration-300 transform-style-3d cursor-pointer shadow-xl rounded-2xl bg-white border border-stone-100', isFlipped ? 'rotate-y-180' : '']">

                                <!-- æ­£é¢ -->
                                <div class="absolute inset-0 backface-hidden flex flex-col items-center justify-center p-8 rounded-2xl bg-white">
                                    <span class="absolute top-4 left-4 text-xs font-bold px-2 py-1 rounded uppercase tracking-wider" :class="isReviewCard(currentCard) ? 'bg-blue-100 text-blue-700' : 'bg-amber-100 text-amber-700'">
                                        {{ isReviewCard(currentCard) ? 'è¤‡ç¿’' : 'æ–°å–®å­—' }}
                                    </span>
                                    <span v-if="currentCard" class="absolute top-4 right-4 text-xs font-bold px-2 py-1 rounded" :class="getLevelColor(currentCard.level)">{{ currentCard.level }}</span>

                                    <h2 class="text-4xl md:text-5xl font-bold text-ramie-900 text-center mb-4 leading-snug">{{ currentCard.kaxabu }}</h2>
                                    <p class="text-stone-400 text-sm mt-4 italic">é»æ“Šç¿»é¢æŸ¥çœ‹è§£é‡‹</p>
                                </div>

                                <!-- èƒŒé¢ -->
                                <div class="absolute inset-0 backface-hidden rotate-y-180 flex flex-col items-center justify-center p-8 rounded-2xl bg-stone-50 border-2 border-ramie-100">
                                    <span class="absolute top-4 left-4 text-xs font-bold px-2 py-1 bg-ramie-100 text-ramie-700 rounded uppercase tracking-wider">ä¸­æ–‡</span>

                                    <h3 class="text-3xl font-serif-tc font-bold text-gray-800 mb-2 text-center">{{ currentCard.chinese }}</h3>
                                    <div class="w-12 h-1 bg-ramie-300 rounded mb-4"></div>
                                    <p class="text-gray-600 mb-1"><span class="font-bold text-xs text-gray-400 uppercase mr-2">é¡åˆ¥</span> {{ currentCard.category }}</p>
                                    <!-- æš«æ™‚å–æ¶ˆé€™å€‹åŠŸèƒ½ æ‰€ä»¥åŠ äº† && FALSE -->
                                    <p v-if="currentCard && currentCard.note && false" class="text-gray-500 text-sm mt-4 bg-white px-4 py-2 rounded-lg border border-gray-100 shadow-sm">
                                        <i class="ph ph-info mr-1"></i> {{ currentCard.note }}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- æ“ä½œæŒ‰éˆ• -->
                        <div class="grid grid-cols-4 gap-3 w-full mt-6" v-if="isFlipped && currentCard">
                        <button @click.stop="rateCard('again')" class="flex flex-col items-center justify-center p-3 rounded-xl bg-red-50 hover:bg-red-100 text-red-700 border border-red-200 transition-colors">
                            <span class="text-sm font-bold uppercase mb-1">å¿˜è¨˜</span>
                            <span class="text-xs opacity-70">1 min</span>
                        </button>
                        <button @click.stop="rateCard('hard')" class="flex flex-col items-center justify-center p-3 rounded-xl bg-orange-50 hover:bg-orange-100 text-orange-700 border border-orange-200 transition-colors">
                            <span class="text-sm font-bold uppercase mb-1">å›°é›£</span>
                            <span class="text-xs opacity-70">2 days</span>
                        </button>
                        <button @click.stop="rateCard('good')" class="flex flex-col items-center justify-center p-3 rounded-xl bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 transition-colors">
                            <span class="text-sm font-bold uppercase mb-1">è‰¯å¥½</span>
                            <span class="text-xs opacity-70">4 days</span>
                        </button>
                        <button @click.stop="rateCard('easy')" class="flex flex-col items-center justify-center p-3 rounded-xl bg-green-50 hover:bg-green-100 text-green-700 border border-green-200 transition-colors">
                            <span class="text-sm font-bold uppercase mb-1">ç°¡å–®</span>
                            <span class="text-xs opacity-70">7 days</span>
                        </button>
                        </div>
                        <div v-else class="w-full text-center mt-6">
                            <button @click="flipCard" class="w-full py-4 rounded-xl bg-ramie-800 text-white font-bold shadow-lg hover:bg-ramie-800 transition-all transform active:scale-95">
                                é¡¯ç¤ºç­”æ¡ˆ
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ç©ºç‹€æ…‹ï¼ˆéšæ®µå®Œæˆï¼‰ -->
                <div v-else class="text-center py-12 px-6 bg-white rounded-3xl shadow-sm border border-stone-100">
                    <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="ph ph-check-fat text-4xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">MUUPUT LIA!</h2>
                    <p class="text-gray-500 mb-8">å·²ç¶“å®Œæˆäº†ä»Šå¤©çš„é€²åº¦ã€‚ä¼‘æ¯ä¸€ä¸‹ï¼Œæ˜å¤©å†ç¹¼çºŒå§ã€‚</p>
                    <button @click="generateSession(true)" class="text-ramie-700 font-medium hover:text-ramie-900 underline">
                        HAAPET A MUBAZA, æƒ³å¤šå­¸ä¸€é» (å¢åŠ  {{ settings.dailyNewLimit }} å€‹æ–°å–®å­—)
                    </button>
                </div>
            </div>

            <!-- VIEWï¼šæœå°‹ï¼è©å…¸ -->
            <div v-if="currentView === 'search'" class="h-full flex flex-col max-w-4xl mx-auto p-4 md:p-6">
                <div class="flex flex-col md:flex-row gap-4 mb-6">
                    <div class="relative flex-1">
                        <i class="ph ph-magnifying-glass absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input v-model="searchQuery" type="text" placeholder="æœå°‹å™¶å“ˆå·«èªæˆ–ä¸­æ–‡..." class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-ramie-500 shadow-sm">
                    </div>
                    <select v-model="filterLevel" class="px-4 py-3 rounded-xl border border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-ramie-500">
                        <option value="">æ‰€æœ‰é›£åº¦</option>
                        <option value="åˆç´š">åˆç´š</option>
                        <option value="ä¸­ç´š">ä¸­ç´š</option>
                        <option value="ä¸­é«˜ç´š">ä¸­é«˜ç´š</option>
                        <option value="é«˜ç´š">é«˜ç´š</option>
                    </select>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden flex-1 flex flex-col">
                    <div class="overflow-y-auto flex-1">
                        <table class="w-full text-left table-fixed">
                            <thead class="bg-earth-100 text-gray-600 text-sm sticky top-0 z-10">
                                <tr>
                                    <th class="p-4 font-semibold w-[25%]">å™¶å“ˆå·«èª</th>
                                    <th class="p-4 font-semibold w-[30%]">ä¸­æ–‡</th>
                                    <th class="p-4 font-semibold hidden md:table-cell w-[15%]">é›£åº¦</th>
                                    <th class="p-4 font-semibold hidden md:table-cell w-[20%]">ä¸‹æ¬¡è¤‡ç¿’</th>
                                    <th class="p-4 font-semibold text-right w-[10%]">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                <tr v-for="word in filteredWords" :key="word._uuid" class="hover:bg-earth-100/30 transition-colors">
                                    <td class="p-4 font-medium text-ramie-900">{{ word.kaxabu }}</td>
                                    <td class="p-4 text-gray-700">{{ word.chinese }}</td>
                                    <td class="p-4 hidden md:table-cell">
                                        <span class="text-xs px-2 py-1 rounded-full font-medium whitespace-nowrap inline-block" :class="getLevelColor(word.level)">{{ word.level }}</span>
                                    </td>
                                    <td class="p-4 text-xs text-gray-500 hidden md:table-cell whitespace-nowrap">
                                        {{ getNextReviewText(word._uuid) }}
                                    </td>
                                    <td class="p-4 text-right">
                                        <button @click="resetWordProgress(word._uuid)" title="é‡ç½®å­¸ç¿’é€²åº¦" class="text-gray-400 hover:text-red-600 p-1">
                                            <i class="ph ph-arrow-counter-clockwise"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr v-if="filteredWords.length === 0">
                                    <td colspan="5" class="p-8 text-center text-gray-500">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆçš„è©å½™</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="p-3 bg-gray-50 border-t border-gray-200 text-xs text-gray-500 flex justify-between">
                        <span>é¡¯ç¤º {{ filteredWords.length }} ç­†è³‡æ–™</span>
                    </div>
                </div>
            </div>

            <!-- VIEWï¼šçµ±è¨ˆè³‡æ–™ -->
            <div v-if="currentView === 'stats'" class="p-4 md:p-8 max-w-4xl mx-auto">
                <h2 class="text-2xl font-bold text-ramie-900 mb-6 font-serif-tc">å­¸ç¿’çµ±è¨ˆ</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                        <div class="flex items-center gap-3 mb-2">
                            <div class="p-2 bg-blue-100 text-blue-600 rounded-lg">
                                <i class="ph ph-book-bookmark text-xl"></i>
                            </div>
                            <h3 class="font-medium text-gray-600">ç¸½å­¸ç¿’å–®å­—</h3>
                        </div>
                        <p class="text-3xl font-bold text-gray-800">{{ Object.keys(userProgress).length }} <span class="text-sm font-normal text-gray-400">/ {{ words.length }}</span></p>
                    </div>

                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                        <div class="flex items-center gap-3 mb-2">
                            <div class="p-2 bg-green-100 text-green-600 rounded-lg">
                                <i class="ph ph-fire text-xl"></i>
                            </div>
                            <h3 class="font-medium text-gray-600">é€£çºŒæ‰“å¡</h3>
                        </div>
                        <p class="text-3xl font-bold text-gray-800">{{ stats.streak }} <span class="text-sm font-normal text-gray-400">å¤©</span></p>
                    </div>

                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                        <div class="flex items-center gap-3 mb-2">
                            <div class="p-2 bg-ramie-100 text-ramie-600 rounded-lg">
                                <i class="ph ph-target text-xl"></i>
                            </div>
                            <h3 class="font-medium text-gray-600">ç¸½é«”ç†Ÿç·´åº¦</h3>
                        </div>
                        <p class="text-3xl font-bold text-gray-800">{{ masteryPercentage }}%</p>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100 mb-8">
                    <h3 class="font-bold text-gray-800 mb-4">è¨˜æ†¶åˆ†ä½ˆ</h3>
                    <div class="space-y-3">
                        <div v-for="(count, label) in retentionStats" :key="label" class="border border-gray-100 rounded-lg overflow-hidden">
                            <!-- é¡åˆ¥æ¨™é¡Œèˆ‡é€²åº¦æ¢ -->
                            <button
                                @click="toggleRetentionCategory(label)"
                                class="w-full p-3 hover:bg-gray-50 transition-colors text-left"
                                :class="expandedRetentionCategory === label ? 'bg-gray-50' : ''"
                            >
                                <div class="flex justify-between text-sm mb-2 items-center">
                                    <div class="flex items-center gap-2">
                                        <i class="ph" :class="expandedRetentionCategory === label ? 'ph-caret-down' : 'ph-caret-right'"></i>
                                        <span class="text-gray-600 font-medium">{{ label }}</span>
                                    </div>
                                    <span class="font-medium text-gray-900">{{ count }} å­—</span>
                                </div>
                                <div class="w-full bg-gray-100 rounded-full h-2.5">
                                    <div class="bg-ramie-600 h-2.5 rounded-full transition-all" :style="{ width: (words.length > 0 ? (count / words.length * 100) : 0) + '%' }"></div>
                                </div>
                            </button>

                            <!-- å±•é–‹çš„å–®å­—åˆ—è¡¨ -->
                            <div v-if="expandedRetentionCategory === label && count > 0" class="border-t border-gray-100 bg-gray-50/50 p-3 max-h-60 overflow-y-auto">
                                <div class="grid grid-cols-1 gap-2">
                                    <div
                                        v-for="word in getWordsInCategory(label)"
                                        :key="word._uuid"
                                        class="flex items-center justify-between p-2 bg-white rounded border border-gray-100 hover:border-ramie-300 transition-colors text-sm"
                                    >
                                        <div class="flex-1">
                                            <span class="font-medium text-ramie-900">{{ word.kaxabu }}</span>
                                            <span class="text-gray-500 mx-2">Â·</span>
                                            <span class="text-gray-700">{{ word.chinese }}</span>
                                        </div>
                                        <span class="text-xs px-2 py-0.5 rounded-full font-medium" :class="getLevelColor(word.level)">
                                            {{ word.level }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEWï¼šç³»çµ±è¨­å®š -->
            <div v-if="currentView === 'settings'" class="p-4 md:p-8 max-w-2xl mx-auto">
                <h2 class="text-2xl font-bold text-ramie-900 mb-6 font-serif-tc">ç³»çµ±è¨­å®š</h2>

                <div class="bg-white rounded-2xl shadow-sm border border-stone-100 overflow-hidden mb-6">
                    <div class="p-6 border-b border-gray-100">
                        <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <i class="ph ph-sliders text-ramie-600"></i> å­¸ç¿’åå¥½
                        </h3>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">æ¯æ—¥æ–°è©æ•¸é‡é™åˆ¶</label>
                                <input v-model.number="settings.dailyNewLimit" type="number" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-ramie-500 focus:border-ramie-500">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">åŒ…å«çš„é›£åº¦ç­‰ç´š</label>
                                <div class="flex flex-wrap gap-4">
                                    <label class="flex items-center gap-2">
                                        <input type="checkbox" v-model="settings.levels" value="åˆç´š" class="text-ramie-600 focus:ring-ramie-500 rounded">
                                        <span class="text-sm">åˆç´š</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="checkbox" v-model="settings.levels" value="ä¸­ç´š" class="text-ramie-600 focus:ring-ramie-500 rounded">
                                        <span class="text-sm">ä¸­ç´š</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="checkbox" v-model="settings.levels" value="ä¸­é«˜ç´š" class="text-ramie-600 focus:ring-ramie-500 rounded">
                                        <span class="text-sm">ä¸­é«˜ç´š</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="checkbox" v-model="settings.levels" value="é«˜ç´š" class="text-ramie-600 focus:ring-ramie-500 rounded">
                                        <span class="text-sm">é«˜ç´š</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="p-6 bg-stone-50">
                        <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <i class="ph ph-database text-ramie-600"></i> è³‡æ–™ç®¡ç†
                        </h3>
                        <div class="flex flex-col gap-3">
                            <button @click="exportData" class="w-full py-2 px-4 bg-white border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 flex items-center justify-center gap-2">
                                <i class="ph ph-download-simple"></i> åŒ¯å‡ºå­¸ç¿’é€²åº¦ (JSON)
                            </button>
                            <div class="relative">
                                <input type="file" @change="importData" accept=".json" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                                <button class="w-full py-2 px-4 bg-white border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 flex items-center justify-center gap-2">
                                    <i class="ph ph-upload-simple"></i> åŒ¯å…¥å­¸ç¿’é€²åº¦
                                </button>
                            </div>
                            <button @click="clearAllProgress" class="w-full py-2 px-4 bg-red-50 border border-red-200 rounded-lg text-red-600 font-medium hover:bg-red-100 mt-2">
                                é‡ç½®æ‰€æœ‰é€²åº¦ (ç„¡æ³•å¾©åŸ)
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEWï¼šé—œæ–¼ -->
            <div v-if="currentView === 'about'" class="p-4 md:p-8 max-w-3xl mx-auto">
                <h2 class="text-2xl font-bold text-ramie-900 mb-6 font-serif-tc">é—œæ–¼</h2>

                <div class="bg-white rounded-2xl shadow-sm border border-stone-100 overflow-hidden mb-6">
                    <div class="p-8">
                        <div class="mb-8 text-center">
                            <div class="w-20 h-20 bg-ramie-700 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                                <span class="font-serif-tc font-bold text-5xl text-white">ğ•‚</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">å™¶å“ˆå·«åƒè©è¨˜æ†¶å¡</h3>
                            <p class="text-gray-500">saanu pitelet Kaxabu a ahan</p>
                        </div>

                        <div class="space-y-4 text-gray-700 leading-relaxed">
                            <p>
                                æ„Ÿè¬åŸä½æ°‘æ—å§”å“¡æœƒ114å¹´åº¦å¹³åŸ”æ—ç¾¤èªè¨€å¾©æŒ¯è¨ˆç•«æ”¯æŒã€‚
                            </p>

                            <div class="bg-earth-100/50 rounded-lg p-4 space-y-2">
                                <p><strong>åŸ·è¡Œå–®ä½ï¼š</strong>å—æŠ•ç¸£åŸ”é‡Œé®èœˆèš£ç¤¾å€ç™¼å±•å”æœƒ</p>
                                <p><strong>è¨ˆç•«æ¨å‹•å“¡ï¼š</strong>è˜‡å½™ä¼¶ï¼ˆAbuaï¼‰</p>
                                <p><strong>ç¶²é ç¨‹å¼èˆ‡åƒè©è¡¨ç·¨è¼¯ï¼š</strong>é»ƒå­è±ªï¼ˆAsiloï¼‰</p>
                                <p><strong>åƒè©è¡¨ç·¨è¼¯ï¼š</strong>ç¿å‹¤é›¯ï¼ˆBiluanï¼‰ã€ç¾…ç‡å¦‚ï¼ˆKabaxaï¼‰ã€å‘¨çˆè±ï¼ˆKimlÃ©ï¼‰</p>
                            </div>

                            <div class="bg-ramie-50/50 rounded-lg p-4 mt-6">
                                <h4 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                                    <i class="ph ph-books text-ramie-600"></i>
                                    åƒè€ƒè³‡æ–™
                                </h4>
                                <ul class="space-y-2 text-sm text-gray-700 leading-relaxed">
                                    <li>â€¢ Li, Paul Jen-kuei and Shigeru Tsuchida. 2001.<em>Pazih dictionary</em>. Language and Linguistics Monograph Series A2. Taipei: Institute of Linguistics (Preparatory Office), Academia Sinica.</li>
                                    <li>â€¢ æ½˜æ°¸æ­·åŸè‘—;è‘£å¿ å¸ç¸½ç·¨è¼¯;é™³å¬¿åº„ä¸»ç·¨;æ½˜æ­£æµ©ã€æ—é´»ç‘ã€æ¶‚æ–‡æ¬½ã€æœ±æ©æˆç·¨è¼¯. 2015.<em>ã€Šå™¶å“ˆå·«èªåˆ†é¡è¾­å…¸ã€‹</em>ã€‚å—æŠ•:å—æŠ•ç¸£åŸ”é‡Œé®å®ˆåŸç¤¾å€ç™¼å±•å”æœƒã€‚</li>
                                    <li>â€¢ æ—é´»ç‘. 2023.<em>ã€Šå™¶å“ˆå·«èªåƒè€ƒèªæ³•:ä¸€å€‹æ¥µåº¦ç€•å±çš„è‡ºç£å—å³¶èªã€‹(ä¸Šã€ä¸‹å†Š)</em>ã€‚èŠ±è“®:åœ‹ç«‹æ±è¯å¤§å­¸åŸä½æ°‘æ°‘æ—å­¸é™¢å‡ºç‰ˆç¤¾ã€‚</li>
                                </ul>
                            </div>

                            <div class="border-t border-gray-200 pt-4 mt-6">
                                <p class="text-sm text-gray-600">
                                    è‹¥æœ‰ Bug æˆ–æ˜¯éŒ¯èª¤å…§å®¹ï¼Œæ­¡è¿é–‹å•Ÿ issue å›å ±æˆ–æ˜¯è¯çµ¡ Asiloã€‚
                                </p>
                                <a href="https://github.com/Babizu/sahan-kaxabu/issues" target="_blank" rel="noopener noreferrer"
                                   class="inline-flex items-center gap-2 mt-3 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900 transition-colors text-sm font-medium">
                                    <i class="ph ph-github-logo text-lg"></i>
                                    GitHub Issues
                                    <i class="ph ph-arrow-square-out text-sm"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                // === å¸¸æ•¸å®šç¾© ===
                // è³‡æ–™æ ¼å¼ç‰ˆæœ¬è™Ÿ
                // ç•¶è³‡æ–™çµæ§‹ç™¼ç”Ÿä¸å…¼å®¹çš„è®Šæ›´æ™‚ï¼Œéœ€è¦å¢åŠ æ­¤ç‰ˆæœ¬è™Ÿä¸¦å¯¦ä½œé·ç§»é‚è¼¯
                // ç‰ˆæœ¬æ­·å²ï¼š
                //   v1 (2026-01-02): åˆå§‹ç‰ˆæœ¬ï¼Œä½¿ç”¨ _uuid (kaxabu-chinese) ä½œç‚ºå”¯ä¸€è­˜åˆ¥ç¢¼
                const DATA_VERSION = 1;

                // ç†Ÿç·´åº¦é¡åˆ¥å¸¸æ•¸
                const PROFICIENCY_CATEGORIES = {
                    NOT_STARTED: 'æœªå­¸ç¿’',
                    NEW: 'æ–°æ‰‹',
                    LEARNING: 'å­¸ç¿’ä¸­',
                    REVIEW: 'ç†Ÿç·´'
                };

                // ç‹€æ…‹ç®¡ç†
                const currentView = ref('study');
                const loading = ref(true);
                const error = ref(null);
                const mobileMenuOpen = ref(false);
                const showOnboarding = ref(false);
                const tempSelectedLevels = ref(['åˆç´š', 'ä¸­ç´š', 'ä¸­é«˜ç´š', 'é«˜ç´š']); // æš«å­˜çš„é›£åº¦é¸æ“‡ï¼ˆç”¨æ–¼å¼•å°é é¢ï¼‰
                const expandedRetentionCategory = ref(null); // è¨˜æ†¶åˆ†ä½ˆå±•é–‹çš„é¡åˆ¥

                // è³‡æ–™å„²å­˜
                const words = ref([]);
                // å­¸ç¿’é€²åº¦ç´€éŒ„ï¼škey ç‚º _uuidï¼ˆæ ¼å¼ï¼šå™¶å“ˆå·«èª-ä¸­æ–‡ï¼Œå¦‚ "yasia-ä»–å€‘ã€é‚£äº›"ï¼‰
                // æ³¨æ„ï¼š_uuid æœƒåŒ…å«ç©ºç™½ã€æ¨™é»ç¬¦è™ŸåŠé ASCII å­—å…ƒï¼ˆä¸­æ–‡ï¼‰
                // value ç‚ºé€²åº¦ç‰©ä»¶ï¼š{ interval, repetitions, ef, nextReview, lastReview }
                const userProgress = ref({});
                const settings = ref({
                    dailyNewLimit: 10,
                    levels: [] // åˆå§‹ç‚ºç©ºï¼Œå°‡ç”±å¼•å°é é¢æˆ– localStorage è¨­å®š
                });
                const stats = ref({
                    lastStudyDate: null,
                    streak: 0,
                    todayStudied: 0,
                    todayDate: null
                });

                // å­¸ç¿’éšæ®µ
                const sessionQueue = ref([]);
                const currentCardIndex = ref(0);
                const isFlipped = ref(false);
                const sessionTotal = ref(0); // ç”¨æ–¼è¨ˆç®—é€²åº¦æ¢

                // æœå°‹åŠŸèƒ½
                const searchQuery = ref('');
                const filterLevel = ref('');

                // ç”Ÿå‘½é€±æœŸ
                onMounted(async () => {
                    loadFromLocalStorage();
                    await loadData();
                    generateSession();
                });

                // === æ ¸å¿ƒé‚è¼¯ ===

                const loadData = async () => {
                    loading.value = true;
                    error.value = null;
                    try {
                        const response = await fetch('kaxabu_words.json');
                        if (!response.ok) throw new Error("ç„¡æ³•è®€å– JSON æª”æ¡ˆ (è«‹ç¢ºèªæª”æ¡ˆä½ç½®æˆ–ä¼ºæœå™¨è¨­å®š)");
                        const data = await response.json();

                        // === ç”Ÿæˆå”¯ä¸€è­˜åˆ¥ç¢¼ (_uuid) ===
                        // ç‚ºæ¯å€‹è©æ¢ç”Ÿæˆå”¯ä¸€çš„ UUIDï¼Œç”¨æ–¼ï¼š
                        // 1. Vue çš„ v-for :key ç¶å®šï¼ˆé¿å…é‡è¤‡ id å°è‡´çš„æ¸²æŸ“å•é¡Œï¼‰
                        // 2. å­¸ç¿’é€²åº¦è¿½è¹¤ï¼ˆuserProgress çš„ keyï¼‰
                        //
                        // UUID æ ¼å¼ï¼š`${å™¶å“ˆå·«èª}-${ä¸­æ–‡}`
                        // ä¾‹å¦‚ï¼š"yasia-ä»–å€‘ã€é‚£äº›ï¼ˆä¸å¯è¦‹ï¼Œæ­¤å½¢å¼ç•¶ä»£è¼ƒä¸ä½¿ç”¨ï¼‰"
                        //       "azang; ida-ä¸€"
                        //
                        // æ³¨æ„äº‹é …ï¼š
                        // - id æ¬„ä½æ˜¯èªæ„ç·¨è™Ÿï¼ˆå¦‚ "02-06"ï¼‰ï¼Œä¸æ˜¯å”¯ä¸€è­˜åˆ¥ç¢¼ï¼Œå¤šå€‹è©æ¢å¯èƒ½å…±ç”¨åŒä¸€ id
                        // - _uuid æœƒåŒ…å«ç©ºç™½ã€æ¨™é»ç¬¦è™Ÿï¼ˆå¦‚ï¼šï¼›ã€ï¼ˆï¼‰etc.ï¼‰åŠé ASCII å­—å…ƒï¼ˆä¸­æ–‡ï¼‰
                        // - ä½¿ç”¨ kaxabu + chinese çµ„åˆï¼Œå› ç‚ºè©è¡¨æœƒç¶“å¸¸è®Šå‹•ï¼ˆæ–°å¢ã€åˆªé™¤ã€ä¿®æ”¹è©æ¢ï¼‰
                        words.value = data.map((word) => ({
                            ...word,
                            _uuid: `${word.kaxabu}-${word.chinese}`
                        }));

                        // === æ¸…ç†éæœŸçš„å­¸ç¿’ç´€éŒ„ ===
                        // ç•¶è©è¡¨æ›´æ–°å¾Œï¼ˆè©æ¢è¢«åˆªé™¤æˆ–ä¿®æ”¹ï¼‰ï¼Œæ¸…é™¤ localStorage ä¸­ä¸å­˜åœ¨çš„å­¸ç¿’ç´€éŒ„
                        // é¿å…ç´¯ç©ç„¡æ•ˆçš„è³‡æ–™
                        const validUuids = new Set(words.value.map(w => w._uuid));
                        let cleanedCount = 0;
                        Object.keys(userProgress.value).forEach(uuid => {
                            if (!validUuids.has(uuid)) {
                                delete userProgress.value[uuid];
                                cleanedCount++;
                            }
                        });
                        if (cleanedCount > 0) {
                            console.log(`å·²æ¸…ç† ${cleanedCount} ç­†éæœŸçš„å­¸ç¿’ç´€éŒ„`);
                            saveToLocalStorage();
                        }
                    } catch (e) {
                        console.error(e);
                        error.value = e.message + "ã€‚æç¤ºï¼šè‹¥æ‚¨æ˜¯ç›´æ¥æ‰“é–‹ HTMLï¼Œè«‹æ”¹ç”¨ Live Server æˆ–éƒ¨ç½²è‡³ GitHub Pagesã€‚";
                    } finally {
                        loading.value = false;
                    }
                };

                const loadFromLocalStorage = () => {
                    const savedProgress = localStorage.getItem('kaxabu_progress');
                    const savedSettings = localStorage.getItem('kaxabu_settings');
                    const savedStats = localStorage.getItem('kaxabu_stats');
                    const onboardingCompleted = localStorage.getItem('kaxabu_onboarding_completed');
                    const savedVersion = localStorage.getItem('kaxabu_data_version');

                    // === è³‡æ–™ç‰ˆæœ¬æª¢æ¸¬èˆ‡é·ç§» ===
                    // æª¢æŸ¥å„²å­˜çš„è³‡æ–™ç‰ˆæœ¬æ˜¯å¦èˆ‡ç•¶å‰ç‰ˆæœ¬ä¸€è‡´
                    const storedVersion = savedVersion ? parseInt(savedVersion) : 0;

                    if (storedVersion === 0 && savedProgress) {
                        // ç‰ˆæœ¬ 0ï¼šæ²’æœ‰ç‰ˆæœ¬è™Ÿçš„èˆŠè³‡æ–™ï¼Œéœ€è¦é·ç§»
                        console.log('åµæ¸¬åˆ°èˆŠç‰ˆè³‡æ–™æ ¼å¼ï¼Œæ­£åœ¨é·ç§»è‡³ç‰ˆæœ¬ ' + DATA_VERSION);
                        // ç›®å‰èˆŠç‰ˆè³‡æ–™å·²ç¶“ä½¿ç”¨ _uuid æ ¼å¼ï¼Œç„¡éœ€ç‰¹åˆ¥é·ç§»
                        // æœªä¾†å¦‚æœéœ€è¦é·ç§»ï¼Œåœ¨é€™è£¡å¯¦ä½œ
                        localStorage.setItem('kaxabu_data_version', DATA_VERSION.toString());
                    } else if (storedVersion > 0 && storedVersion < DATA_VERSION) {
                        // æœ‰ç‰ˆæœ¬è™Ÿä½†ç‰ˆæœ¬è¼ƒèˆŠï¼Œéœ€è¦é·ç§»
                        console.log(`æ­£åœ¨å°‡è³‡æ–™å¾ç‰ˆæœ¬ ${storedVersion} é·ç§»è‡³ç‰ˆæœ¬ ${DATA_VERSION}`);
                        // æ ¹æ“šä¸åŒç‰ˆæœ¬å¯¦ä½œé·ç§»é‚è¼¯
                        migrateData(storedVersion, DATA_VERSION);
                        localStorage.setItem('kaxabu_data_version', DATA_VERSION.toString());
                    } else if (storedVersion === 0 && !savedProgress) {
                        // å…¨æ–°ç”¨æˆ¶ï¼Œç›´æ¥è¨­å®šç‚ºç•¶å‰ç‰ˆæœ¬
                        localStorage.setItem('kaxabu_data_version', DATA_VERSION.toString());
                    }

                    if (savedProgress) userProgress.value = JSON.parse(savedProgress);
                    if (savedSettings) {
                        settings.value = JSON.parse(savedSettings);
                    }

                    // åªåœ¨ç”¨æˆ¶å¾æœªå®Œæˆå¼•å°æ™‚é¡¯ç¤ºå¼•å°é é¢
                    if (!onboardingCompleted) {
                        showOnboarding.value = true;
                        // é‡è¨­ç‚ºé è¨­é¸é …ï¼ˆå…¨é¸ï¼‰
                        tempSelectedLevels.value = ['åˆç´š', 'ä¸­ç´š', 'ä¸­é«˜ç´š', 'é«˜ç´š'];
                    }

                    if (savedStats) stats.value = JSON.parse(savedStats);
                };

                // === è³‡æ–™é·ç§»å‡½æ•¸ ===
                // ç•¶è³‡æ–™æ ¼å¼ç‰ˆæœ¬æ›´æ–°æ™‚ï¼Œè² è²¬å°‡èˆŠç‰ˆæœ¬è³‡æ–™é·ç§»åˆ°æ–°ç‰ˆæœ¬
                // åƒæ•¸ï¼š
                //   fromVersion: èˆŠç‰ˆæœ¬è™Ÿ
                //   toVersion: ç›®æ¨™ç‰ˆæœ¬è™Ÿ
                const migrateData = (fromVersion, toVersion) => {
                    console.log(`é–‹å§‹è³‡æ–™é·ç§»ï¼šv${fromVersion} -> v${toVersion}`);

                    // æœªä¾†çš„é·ç§»é‚è¼¯ç¯„ä¾‹ï¼š
                    // if (fromVersion === 1 && toVersion === 2) {
                    //     // å¾ç‰ˆæœ¬ 1 é·ç§»åˆ°ç‰ˆæœ¬ 2 çš„é‚è¼¯
                    //     const oldProgress = JSON.parse(localStorage.getItem('kaxabu_progress') || '{}');
                    //     const newProgress = {};
                    //     Object.keys(oldProgress).forEach(key => {
                    //         // è½‰æ›è³‡æ–™æ ¼å¼
                    //         newProgress[convertKey(key)] = oldProgress[key];
                    //     });
                    //     localStorage.setItem('kaxabu_progress', JSON.stringify(newProgress));
                    // }

                    console.log('è³‡æ–™é·ç§»å®Œæˆ');
                };

                const saveToLocalStorage = () => {
                    localStorage.setItem('kaxabu_progress', JSON.stringify(userProgress.value));
                    localStorage.setItem('kaxabu_settings', JSON.stringify(settings.value));
                    localStorage.setItem('kaxabu_stats', JSON.stringify(stats.value));
                    // å„²å­˜è³‡æ–™æ ¼å¼ç‰ˆæœ¬è™Ÿ
                    localStorage.setItem('kaxabu_data_version', DATA_VERSION.toString());
                };

                // === é–“éš”é‡è¤‡æ¼”ç®—æ³•ï¼ˆåŸºæ–¼ SuperMemo-2ï¼‰===
                // æ ¹æ“šä½¿ç”¨è€…çš„å›ç­”å“è³ªæ›´æ–°å–®å­—çš„å­¸ç¿’é€²åº¦
                // åƒæ•¸ï¼š
                //   wordUuid: è©æ¢çš„å”¯ä¸€è­˜åˆ¥ç¢¼ï¼ˆæ ¼å¼ï¼šå™¶å“ˆå·«èª-ä¸­æ–‡ï¼ŒåŒ…å«ç©ºç™½åŠä¸­æ–‡å­—å…ƒï¼‰
                //   quality: å“è³ªè©•åˆ† 0-5ï¼ˆæŒ‰éˆ•å°æ‡‰ï¼šå¿˜è¨˜=0, å›°é›£=3, è‰¯å¥½=4, ç°¡å–®=5ï¼‰
                const updateWordProgress = (wordUuid, quality) => {
                    const isNewWord = !userProgress.value[wordUuid];
                    let p = userProgress.value[wordUuid] || { interval: 0, repetitions: 0, ef: 2.5, nextReview: 0 };

                    // å¦‚æœæ˜¯ä»Šå¤©ç¬¬ä¸€å¼µå¡ç‰‡ï¼Œæ›´æ–°é€£çºŒæ‰“å¡å¤©æ•¸
                    const todayStr = new Date().toDateString();
                    if (stats.value.lastStudyDate !== todayStr) {
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);
                        if (stats.value.lastStudyDate === yesterday.toDateString()) {
                            stats.value.streak++;
                        } else if (stats.value.lastStudyDate !== todayStr) {
                            stats.value.streak = 1;
                        }
                        stats.value.lastStudyDate = todayStr;
                    }

                    // è¿½è¹¤ä»Šæ—¥å­¸ç¿’çš„æ–°å–®å­—æ•¸é‡
                    if (isNewWord) {
                        if (stats.value.todayDate !== todayStr) {
                            stats.value.todayStudied = 1;
                            stats.value.todayDate = todayStr;
                        } else {
                            stats.value.todayStudied++;
                        }
                    }

                    if (quality < 3) {
                        p.repetitions = 0;
                        p.interval = 1; // 1 å¤©ï¼ˆç°¡åŒ–ç‰ˆæœ¬ä¸­æŠ€è¡“ä¸Šç‚º 0ï¼Œä½†æˆ‘å€‘å¸Œæœ›å®ƒç›¡å¿«å›ä¾†ï¼‰
                    } else {
                        p.repetitions += 1;
                        if (p.repetitions === 1) p.interval = 1;
                        else if (p.repetitions === 2) p.interval = 6;
                        else p.interval = Math.round(p.interval * p.ef);
                    }

                    p.ef = p.ef + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
                    if (p.ef < 1.3) p.ef = 1.3;

                    // è¨ˆç®—ä¸‹æ¬¡è¤‡ç¿’æ—¥æœŸï¼ˆæ™‚é–“æˆ³è¨˜ï¼‰
                    const now = new Date();
                    const nextDate = new Date();

                    if (quality === 0) {
                        nextDate.setDate(now.getDate());
                    } else {
                        nextDate.setDate(now.getDate() + p.interval);
                    }

                    p.nextReview = nextDate.getTime();
                    p.lastReview = now.getTime();

                    userProgress.value[wordUuid] = p;
                    saveToLocalStorage();
                };

                const generateSession = (forceAdd = false) => {
                    if (words.value.length === 0) return;

                    const now = new Date().getTime();
                    const todayStr = new Date().toDateString();
                    const dueWords = [];
                    const newWords = [];

                    // å¦‚æœæ˜¯æ–°çš„ä¸€å¤©ï¼Œé‡ç½®æ¯æ—¥è¨ˆæ•¸å™¨
                    if (stats.value.todayDate !== todayStr) {
                        stats.value.todayStudied = 0;
                        stats.value.todayDate = todayStr;
                        saveToLocalStorage();
                    }

                    // 1. å°‹æ‰¾åˆ°æœŸçš„å–®å­—
                    words.value.forEach(w => {
                        if (!settings.value.levels.includes(w.level)) return;

                        const prog = userProgress.value[w._uuid];
                        if (prog) {
                            if (prog.nextReview <= now) {
                                dueWords.push(w);
                            }
                        } else {
                            newWords.push(w);
                        }
                    });

                    // 2. æ ¹æ“šä»Šæ—¥å·²å­¸ç¿’æ•¸é‡é™åˆ¶æ–°å–®å­—
                    let sessionNewLimit = settings.value.dailyNewLimit - stats.value.todayStudied;
                    if (sessionNewLimit < 0) sessionNewLimit = 0;

                    if(forceAdd) {
                        // å¼·åˆ¶å¢åŠ å­¸ç¿’ï¼šä½¿ç”¨ç”¨æˆ¶è¨­å®šçš„æ¯æ—¥æ–°è©æ•¸é‡é™åˆ¶
                        sessionNewLimit = settings.value.dailyNewLimit;
                    } else if (sessionQueue.value.length > 0 && currentCardIndex.value < sessionQueue.value.length) {
                        return; // å¦‚æœéšæ®µä»åœ¨é€²è¡Œä¸­ä¸”é‚„æœ‰å‰©é¤˜å¡ç‰‡ï¼Œä¸è¦é‡æ–°ç”Ÿæˆ
                    }

                    const selectedNew = newWords.slice(0, sessionNewLimit);

                    // 3. çµ„åˆå¡ç‰‡ä½‡åˆ—
                    // å„ªå…ˆé¡¯ç¤ºè¤‡ç¿’å¡ç‰‡
                    sessionQueue.value = [...dueWords, ...selectedNew];
                    sessionTotal.value = sessionQueue.value.length;
                    currentCardIndex.value = 0;
                    isFlipped.value = false;
                };

                // === å¼•å°æµç¨‹ ===

                const completeOnboarding = () => {
                    if (tempSelectedLevels.value.length === 0) return;

                    settings.value.levels = [...tempSelectedLevels.value];
                    localStorage.setItem('kaxabu_onboarding_completed', 'true');
                    saveToLocalStorage();
                    showOnboarding.value = false;

                    // ä½¿ç”¨é¸æ“‡çš„é›£åº¦ç”Ÿæˆå­¸ç¿’éšæ®µ
                    generateSession();
                };

                // === UI æ“ä½œ ===

                const currentCard = computed(() => {
                    if (sessionQueue.value.length === 0 || currentCardIndex.value >= sessionQueue.value.length) return null;
                    return sessionQueue.value[currentCardIndex.value];
                });
                
                const sessionCompleted = computed(() => currentCardIndex.value);

                const flipCard = () => {
                    isFlipped.value = true;
                };

                const isReviewCard = (card) => {
                    if (!card) return false;
                    return userProgress.value[card._uuid] !== undefined;
                };

                const rateCard = (rating) => {
                    if (!currentCard.value) return;

                    let quality = 0;
                    if (rating === 'again') quality = 0;
                    else if (rating === 'hard') quality = 3;
                    else if (rating === 'good') quality = 4;
                    else if (rating === 'easy') quality = 5;

                    const cardToRequeue = currentCard.value;

                    updateWordProgress(currentCard.value._uuid, quality);

                    // å¦‚æœé»é¸ã€Œå¿˜è¨˜ã€æŒ‰éˆ•ï¼ˆå“è³ª 0ï¼‰ï¼Œå°‡å¡ç‰‡é‡æ–°åŠ å…¥ä½‡åˆ—ä»¥ç«‹å³è¤‡ç¿’
                    if (quality === 0) {
                        sessionQueue.value.push(cardToRequeue);
                        sessionTotal.value = sessionQueue.value.length;
                    }

                    // ä¸‹ä¸€å¼µå¡ç‰‡
                    isFlipped.value = false;
                    setTimeout(() => {
                        currentCardIndex.value++;
                    }, 200); // ç¨å¾®å»¶é²ä»¥é…åˆå‹•ç•«
                };

                const navigate = (view) => {
                    currentView.value = view;
                    mobileMenuOpen.value = false;
                };

                const navClass = (view) => {
                    return currentView.value === view 
                        ? 'bg-white text-ramie-700 shadow-sm' 
                        : 'text-gray-500 hover:bg-earth-200/50 hover:text-gray-700';
                };

                const getLevelColor = (level) => {
                    switch(level) {
                        case 'åˆç´š': return 'bg-green-100 text-green-700';
                        case 'ä¸­ç´š': return 'bg-yellow-100 text-yellow-700';
                        case 'ä¸­é«˜ç´š': return 'bg-orange-100 text-orange-700';
                        case 'é«˜ç´š': return 'bg-red-100 text-red-700';
                        default: return 'bg-gray-100 text-gray-600';
                    }
                };

                // === æœå°‹èˆ‡ç¯©é¸ ===
                const filteredWords = computed(() => {
                    return words.value.filter(w => {
                        const matchSearch = (w.kaxabu.toLowerCase().includes(searchQuery.value.toLowerCase()) || 
                                           w.chinese.includes(searchQuery.value));
                        const matchLevel = filterLevel.value ? w.level === filterLevel.value : true;
                        return matchSearch && matchLevel;
                    });
                });

                // å–å¾—ä¸‹æ¬¡è¤‡ç¿’æ™‚é–“çš„é¡¯ç¤ºæ–‡å­—
                // åƒæ•¸ uuid: è©æ¢çš„å”¯ä¸€è­˜åˆ¥ç¢¼ï¼ˆæ ¼å¼ï¼šå™¶å“ˆå·«èª-ä¸­æ–‡ï¼‰
                const getNextReviewText = (uuid) => {
                    const p = userProgress.value[uuid];
                    if (!p) return 'å°šæœªå­¸ç¿’';
                    const diff = p.nextReview - new Date().getTime();
                    if (diff <= 0) return 'è¤‡ç¿’æ™‚é–“åˆ°';
                    const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
                    return `${days} å¤©å¾Œ`;
                };

                // é‡ç½®å–®ä¸€è©æ¢çš„å­¸ç¿’é€²åº¦
                // åƒæ•¸ uuid: è©æ¢çš„å”¯ä¸€è­˜åˆ¥ç¢¼ï¼ˆæ ¼å¼ï¼šå™¶å“ˆå·«èª-ä¸­æ–‡ï¼‰
                const resetWordProgress = (uuid) => {
                    if(confirm('ç¢ºå®šè¦é‡ç½®é€™å€‹å–®å­—çš„å­¸ç¿’é€²åº¦å—ï¼Ÿ')) {
                        delete userProgress.value[uuid];
                        saveToLocalStorage();
                    }
                };

                // === è¨­å®šæ“ä½œ ===
                const exportData = () => {
                    // åŒ¯å‡ºå­¸ç¿’é€²åº¦ã€è¨­å®šå’Œçµ±è¨ˆè³‡æ–™
                    // åŒ…å«è³‡æ–™æ ¼å¼ç‰ˆæœ¬è™Ÿï¼Œç”¨æ–¼æœªä¾†çš„è³‡æ–™é·ç§»
                    const exportObj = {
                        version: DATA_VERSION,  // è³‡æ–™æ ¼å¼ç‰ˆæœ¬è™Ÿ
                        progress: userProgress.value,
                        settings: settings.value,
                        stats: stats.value,
                        exportDate: new Date().toISOString()  // åŒ¯å‡ºæ™‚é–“æˆ³è¨˜
                    };
                    const dataStr = JSON.stringify(exportObj, null, 2); // ä½¿ç”¨ç¸®æ’è®“æª”æ¡ˆæ›´æ˜“è®€
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    const exportFileDefaultName = 'kaxabu_progress_backup.json';

                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                };

                const importData = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const json = JSON.parse(e.target.result);

                            // === æª¢æ¸¬åŒ¯å…¥æª”æ¡ˆçš„è³‡æ–™æ ¼å¼ç‰ˆæœ¬ ===
                            let importVersion = 0;  // é è¨­ç‚ºç‰ˆæœ¬ 0ï¼ˆç„¡ç‰ˆæœ¬è™Ÿçš„èˆŠæ ¼å¼ï¼‰

                            if (json.version !== undefined) {
                                // æ–°æ ¼å¼ï¼šåŒ…å«ç‰ˆæœ¬è™Ÿ
                                importVersion = json.version;
                            } else if (json.progress !== undefined) {
                                // ä¸­æœŸæ ¼å¼ï¼šæœ‰ progress æ¬„ä½ä½†æ²’æœ‰ç‰ˆæœ¬è™Ÿï¼Œè¦–ç‚ºç‰ˆæœ¬ 1
                                importVersion = 1;
                            }

                            // === ç‰ˆæœ¬ç›¸å®¹æ€§æª¢æŸ¥ ===
                            if (importVersion > DATA_VERSION) {
                                // åŒ¯å…¥çš„è³‡æ–™ç‰ˆæœ¬æ¯”ç•¶å‰ç¨‹å¼ç‰ˆæœ¬æ–°ï¼Œç„¡æ³•åŒ¯å…¥
                                alert(`æ­¤å‚™ä»½æª”æ¡ˆä¾†è‡ªè¼ƒæ–°ç‰ˆæœ¬çš„æ‡‰ç”¨ç¨‹å¼ï¼ˆv${importVersion}ï¼‰ï¼Œç•¶å‰ç‰ˆæœ¬ç‚º v${DATA_VERSION}ã€‚\nè«‹æ›´æ–°æ‡‰ç”¨ç¨‹å¼å¾Œå†åŒ¯å…¥æ­¤å‚™ä»½ã€‚`);
                                return;
                            }

                            // === æ ¹æ“šç‰ˆæœ¬è¼‰å…¥è³‡æ–™ ===
                            if (json.progress !== undefined) {
                                // æ–°æ ¼å¼æˆ–ä¸­æœŸæ ¼å¼ï¼šåŒ…å« progress, settings, stats
                                userProgress.value = json.progress || {};
                                if (json.settings) {
                                    settings.value = json.settings;
                                }
                                if (json.stats) {
                                    stats.value = json.stats;
                                }
                            } else {
                                // æœ€èˆŠæ ¼å¼ï¼šåªæœ‰é€²åº¦è³‡æ–™ï¼ˆå‘å¾Œç›¸å®¹ï¼‰
                                userProgress.value = json;
                            }

                            // === è³‡æ–™ç‰ˆæœ¬é·ç§» ===
                            // å¦‚æœåŒ¯å…¥çš„è³‡æ–™ç‰ˆæœ¬è¼ƒèˆŠï¼ŒåŸ·è¡Œé·ç§»
                            if (importVersion < DATA_VERSION) {
                                console.log(`åŒ¯å…¥çš„è³‡æ–™ç‰ˆæœ¬ v${importVersion} è¼ƒèˆŠï¼Œå°‡é·ç§»è‡³ v${DATA_VERSION}`);
                                // é€™è£¡å¯ä»¥èª¿ç”¨ migrateData() é€²è¡Œè³‡æ–™è½‰æ›
                                // ä½†å› ç‚ºè³‡æ–™å·²ç¶“è¼‰å…¥åˆ° userProgress.valueï¼Œ
                                // æ‰€ä»¥ç›´æ¥åœ¨å„²å­˜æ™‚æœƒè‡ªå‹•ä½¿ç”¨ç•¶å‰ç‰ˆæœ¬è™Ÿ
                            }

                            saveToLocalStorage();
                            alert(`é€²åº¦åŒ¯å…¥æˆåŠŸï¼ï¼ˆè³‡æ–™ç‰ˆæœ¬ï¼šv${importVersion}ï¼‰\né é¢å³å°‡é‡æ–°æ•´ç†ã€‚`);
                            // é‡æ–°æ•´ç†é é¢ä»¥ç¢ºä¿æ‰€æœ‰è³‡æ–™åŒæ­¥
                            location.reload();
                        } catch (err) {
                            alert('æª”æ¡ˆæ ¼å¼éŒ¯èª¤ï¼š' + err.message);
                        }
                    };
                    reader.readAsText(file);
                };

                const clearAllProgress = () => {
                    if(confirm('è­¦å‘Šï¼šé€™å°‡åˆªé™¤æ‰€æœ‰å­¸ç¿’ç´€éŒ„ä¸”ç„¡æ³•å¾©åŸã€‚ç¢ºå®šå—ï¼Ÿ')) {
                        userProgress.value = {};
                        stats.value = { lastStudyDate: null, streak: 0, todayStudied: 0, todayDate: null };
                        localStorage.removeItem('kaxabu_onboarding_completed');
                        saveToLocalStorage();
                        location.reload();
                    }
                };

                // === çµ±è¨ˆè¼”åŠ©å‡½æ•¸ ===
                const masteryPercentage = computed(() => {
                    const studied = Object.values(userProgress.value);
                    if (studied.length === 0) return 0;
                    // å®šç¾©ç²¾é€šç‚ºé–“éš” > 21 å¤©
                    const mastered = studied.filter(p => p.interval > 21).length;
                    return Math.round((mastered / words.value.length) * 100);
                });

                // è¨˜æ†¶åˆ†ä½ˆçµ±è¨ˆï¼ˆåŒ…å«å„é¡åˆ¥çš„å–®å­—æ•¸é‡ï¼‰
                const retentionStats = computed(() => {
                    const unstudiedCount = words.value.filter(w => !userProgress.value[w._uuid]).length;
                    const s = {
                        [PROFICIENCY_CATEGORIES.NOT_STARTED]: unstudiedCount,
                        [PROFICIENCY_CATEGORIES.NEW]: 0,
                        [PROFICIENCY_CATEGORIES.LEARNING]: 0,
                        [PROFICIENCY_CATEGORIES.REVIEW]: 0
                    };
                    Object.values(userProgress.value).forEach(p => {
                        if (p.interval < 3) s[PROFICIENCY_CATEGORIES.NEW]++;
                        else if (p.interval < 21) s[PROFICIENCY_CATEGORIES.LEARNING]++;
                        else s[PROFICIENCY_CATEGORIES.REVIEW]++;
                    });
                    return s;
                });

                // å–å¾—ç‰¹å®šç†Ÿç·´åº¦é¡åˆ¥çš„å–®å­—åˆ—è¡¨
                const getWordsInCategory = (category) => {
                    if (category === PROFICIENCY_CATEGORIES.NOT_STARTED) {
                        return words.value.filter(w => !userProgress.value[w._uuid]);
                    }

                    return words.value.filter(w => {
                        const p = userProgress.value[w._uuid];
                        if (!p) return false;

                        if (category === PROFICIENCY_CATEGORIES.NEW) return p.interval < 3;
                        if (category === PROFICIENCY_CATEGORIES.LEARNING) return p.interval >= 3 && p.interval < 21;
                        if (category === PROFICIENCY_CATEGORIES.REVIEW) return p.interval >= 21;
                        return false;
                    });
                };

                // åˆ‡æ›è¨˜æ†¶åˆ†ä½ˆé¡åˆ¥çš„å±•é–‹/æ”¶åˆ
                const toggleRetentionCategory = (category) => {
                    if (expandedRetentionCategory.value === category) {
                        expandedRetentionCategory.value = null;
                    } else {
                        expandedRetentionCategory.value = category;
                    }
                };

                watch(settings, () => {
                    saveToLocalStorage();
                }, { deep: true });

                return {
                    currentView,
                    loading,
                    error,
                    mobileMenuOpen,
                    showOnboarding,
                    tempSelectedLevels,
                    expandedRetentionCategory,
                    words,
                    userProgress,
                    settings,
                    stats,
                    sessionQueue,
                    currentCardIndex,
                    currentCard,
                    isFlipped,
                    sessionCompleted,
                    sessionTotal,
                    searchQuery,
                    filterLevel,
                    filteredWords,
                    navigate,
                    navClass,
                    flipCard,
                    rateCard,
                    getLevelColor,
                    getNextReviewText,
                    resetWordProgress,
                    generateSession,
                    exportData,
                    importData,
                    clearAllProgress,
                    masteryPercentage,
                    retentionStats,
                    getWordsInCategory,
                    toggleRetentionCategory,
                    isReviewCard,
                    completeOnboarding
                };
            }
        }).mount('#app');
    </script>
</body>
</html>